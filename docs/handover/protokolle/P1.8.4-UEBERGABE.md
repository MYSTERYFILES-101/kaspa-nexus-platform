# P1.8.4 - Portfolio Tracker

## Datum: 2025-12-05

## Status: ABGESCHLOSSEN (UI fertig, Backend-Integration ausstehend)

---

## Aufgabe

Erstellung eines kompletten Portfolio Tracking Systems, mit dem User ihre Krypto-Investments verfolgen koennen. Inklusive Nachkaeufe, Durchschnittspreis-Berechnung und Gewinn/Verlust-Tracking.

## Features

### Positions-Management
- **Position hinzufuegen:** Coin, Symbol, Menge, Kaufpreis, Kaufdatum
- **Nachkauf:** Weitere Kaeufe zu bestehender Position hinzufuegen
- **Loeschen:** Positionen entfernen
- **Automatischer Durchschnittspreis:** Bei Nachkaeufen wird der Ø-Preis neu berechnet

### Portfolio Stats (4 Karten)
- **Gesamtwert:** Summe aller Positionen zu aktuellen Preisen
- **Investiert:** Summe aller Kaeufe
- **Gewinn/Verlust:** Differenz in $
- **Rendite:** Prozentuale Aenderung

### Positions-Tabelle
| Spalte | Beschreibung |
|--------|-------------|
| Coin | Name + Symbol mit Icon |
| Menge | Anzahl Coins |
| Ø Preis | Durchschnittlicher Kaufpreis |
| Aktuell | Live-Preis (TODO: API) |
| Wert | Menge × Aktueller Preis |
| +/- | Gewinn/Verlust in $ und % |
| Aktionen | Nachkauf, Loeschen |

### Chart (Platzhalter)
- Zeitraeume: 7D, 30D, 90D, 1Y, ALL
- Wird mit Echtdaten befuellt sobald DB vorhanden

### Transaction History
- Letzte 10 Transaktionen
- Zeigt: Datum, Coin, Menge, Preis pro Coin

### Modals
1. **Position hinzufuegen Modal:**
   - Coin Name (Freitext)
   - Symbol (wird automatisch uppercase)
   - Menge
   - Kaufpreis ($)
   - Kaufdatum

2. **Nachkauf Modal:**
   - Zeigt aktuelle Menge und Ø-Preis
   - Eingabe: Menge, Preis, Datum
   - **Live-Vorschau:** Neue Menge und neuer Ø-Preis

## Durchschnittspreis-Formel

```
neuerØPreis = (alteMenge × alterØPreis + neueMenge × neuerPreis) / (alteMenge + neueMenge)
```

**Beispiel:**
- Bestehend: 1000 KAS @ $0.10
- Nachkauf: 500 KAS @ $0.08
- Neu: (1000×0.10 + 500×0.08) / 1500 = $0.0933

## Dateien

| Datei | Aenderung |
|-------|-----------|
| src/app/investment/tracker/page.tsx | NEU (650+ Zeilen) |
| src/components/investment/InvestmentSwitchbar.tsx | GEAENDERT (Tracker Tab) |
| src/components/layout/Sidebar.tsx | GEAENDERT (Tracker Link) |
| messages/de.json | GEAENDERT (tracker + investmentSwitchbar) |
| messages/en.json | GEAENDERT (tracker + investmentSwitchbar) |

## Navigation

**Switchbar:** 3 Tabs
- Board → /investment
- Portfolio → /investment/portfolio (PRO)
- Tracker → /investment/tracker (PRO)

**Sidebar:** Investment Kategorie
- Board
- Portfolio (PRO)
- Tracker (PRO)

## TypeScript Interfaces

```typescript
interface Position {
  id: string;
  coin: string;
  symbol: string;
  amount: number;
  avgPrice: number;
  currentPrice: number;
  purchases: Purchase[];
  addedAt: string;
}

interface Purchase {
  id: string;
  amount: number;
  price: number;
  date: string;
}

interface PortfolioStats {
  totalValue: number;
  totalInvested: number;
  totalProfitLoss: number;
  totalProfitLossPercent: number;
}
```

## TODO fuer Backend-Integration

1. **Datenbank-Tabellen erstellen:**
   ```sql
   CREATE TABLE user_portfolios (
     id UUID PRIMARY KEY,
     user_id UUID REFERENCES users(id),
     name VARCHAR(255),
     created_at TIMESTAMP
   );

   CREATE TABLE portfolio_positions (
     id UUID PRIMARY KEY,
     portfolio_id UUID REFERENCES user_portfolios(id),
     coin VARCHAR(100),
     symbol VARCHAR(20),
     amount DECIMAL(20,8),
     avg_price DECIMAL(20,8),
     created_at TIMESTAMP
   );

   CREATE TABLE portfolio_purchases (
     id UUID PRIMARY KEY,
     position_id UUID REFERENCES portfolio_positions(id),
     amount DECIMAL(20,8),
     price DECIMAL(20,8),
     purchase_date DATE,
     created_at TIMESTAMP
   );

   CREATE TABLE portfolio_history (
     id UUID PRIMARY KEY,
     portfolio_id UUID REFERENCES user_portfolios(id),
     date DATE,
     total_value DECIMAL(20,2),
     created_at TIMESTAMP
   );
   ```

2. **API Routes:**
   - `GET /api/portfolio/positions` - Alle Positionen laden
   - `POST /api/portfolio/positions` - Position hinzufuegen
   - `POST /api/portfolio/positions/:id/purchase` - Nachkauf
   - `DELETE /api/portfolio/positions/:id` - Position loeschen
   - `GET /api/portfolio/history` - Historische Werte fuer Chart

3. **Live-Preise:**
   - CoinGecko API fuer BTC, ETH, etc.
   - Eigene API fuer KRC-20 Tokens

4. **Cronjob:**
   - Taeglich Portfolio-Wert in `portfolio_history` speichern

## Build-Ergebnis

```
✓ Compiled /investment/tracker in XXXms
HTTP 200 OK
```

Keine Fehler.

## Abnahmekriterien

- [x] Tracker-Seite unter /investment/tracker
- [x] Position hinzufuegen Modal
- [x] Nachkauf Modal mit Vorschau
- [x] Durchschnittspreis-Berechnung
- [x] Positions-Tabelle mit allen Spalten
- [x] Portfolio Stats (4 Karten)
- [x] Chart-Platzhalter mit Zeitraum-Buttons
- [x] Transaction History
- [x] Loeschen-Funktion
- [x] Sidebar + Switchbar aktualisiert
- [x] i18n (DE/EN)
- [x] Responsives Design
- [x] PRO-Badge
- [x] Info-Box (lokale Speicherung Hinweis)
- [x] Build erfolgreich

---

**Erstellt von:** Claude Code
**Geprueft:** Build erfolgreich, HTTP 200
**Naechster Schritt:** Backend + DB Integration (separate Phase)
